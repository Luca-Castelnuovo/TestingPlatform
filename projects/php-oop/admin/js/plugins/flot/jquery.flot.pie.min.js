!function(e){var t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:function(s){function a(i,s,a,r){A||(A=!0,u=i.getCanvas(),g=e(u).parent(),t=i.getOptions(),i.setData(function(e){!function(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(w+=i)}}(e=function(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:void 0!==e[t].data&&void 0!==e[t].data[0]||(void 0!==e[t].data&&void 0!==e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}(e));for(var i=0,s=0,a=t.series.pie.combine.color,r=[],l=0;l<e.length;++l)e[l].data[0][1]=parseFloat(e[l].data[0][1]),e[l].data[0][1]||(e[l].data[0][1]=0),e[l].data[0][1]/w<=t.series.pie.combine.threshold?(i+=e[l].data[0][1],s++,a||(a=e[l].color)):r.push({data:[[1,e[l].data[0][1]]],color:e[l].color,label:e[l].label,angle:e[l].data[0][1]*(2*Math.PI)/w,percent:e[l].data[0][1]/w*100});return s>0&&r.push({data:[[1,i]],color:a,label:t.series.pie.combine.label,angle:i*(2*Math.PI)/w,percent:i/w*100}),r}(i.getData())))}function r(i,s){function a(){ctx.clearRect(0,0,u.width,u.height),g.children().filter(".pieLabel, .pieLabelBackground").remove()}if(g){ctx=s,m=g.children().filter(".legend").children().width(),f=Math.min(u.width,u.height/t.series.pie.tilt)/2,b=u.height/2+t.series.pie.offset.top,v=u.width/2,"auto"==t.series.pie.offset.left?t.legend.position.match("w")?v+=m/2:v-=m/2:v+=t.series.pie.offset.left,v<f?v=f:v>u.width-f&&(v=u.width-f);for(var r=i.getData(),n=0;P&&n<M;)P=!1,n>0&&(f*=k),n+=1,a(),t.series.pie.tilt<=.8&&function(){if(t.series.pie.radius>1)var e=t.series.pie.radius;else e=f*t.series.pie.radius;if(!(e>=u.width/2-5||e*t.series.pie.tilt>=u.height/2-15||e<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(v,b),ctx.scale(1,t.series.pie.tilt);for(var i=1;i<=10;i++)ctx.beginPath(),ctx.arc(0,0,e,0,2*Math.PI,!1),ctx.fill(),e-=i;ctx.restore()}}(),function(){function i(t,i,r){t<=0||(r?ctx.fillStyle=i:(ctx.strokeStyle=i,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(t-2*Math.PI)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(t-=1e-4),ctx.arc(0,0,s,a,a+t,!1),ctx.closePath(),a+=t,r?ctx.fill():ctx.stroke())}if(startAngle=Math.PI*t.series.pie.startAngle,t.series.pie.radius>1)var s=t.series.pie.radius;else s=f*t.series.pie.radius;ctx.save(),ctx.translate(v,b),ctx.scale(1,t.series.pie.tilt),ctx.save();for(var a=startAngle,n=0;n<r.length;++n)r[n].startAngle=a,i(r[n].angle,r[n].color,!0);for(ctx.restore(),ctx.save(),ctx.lineWidth=t.series.pie.stroke.width,a=startAngle,n=0;n<r.length;++n)i(r[n].angle,t.series.pie.stroke.color,!1);ctx.restore(),l(ctx),t.series.pie.label.show&&function(){var i=startAngle;if(t.series.pie.label.radius>1)var s=t.series.pie.label.radius;else s=f*t.series.pie.label.radius;for(var a=0;a<r.length;++a)r[a].percent>=100*t.series.pie.label.threshold&&function(i,a,r){if(0!=i.data[0][1]){var l,n=t.legend.labelFormatter,o=t.series.pie.label.formatter;l=n?n(i.label,i):i.label,o&&(l=o(l,i));var p=(a+i.angle+a)/2,c=v+Math.round(Math.cos(p)*s),h=b+Math.round(Math.sin(p)*s)*t.series.pie.tilt,d='<span class="pieLabel" id="pieLabel'+r+'" style="position:absolute;top:'+h+"px;left:"+c+'px;">'+l+"</span>";g.append(d);var f=g.children("#pieLabel"+r),x=h-f.height()/2,w=c-f.width()/2;if(f.css("top",x),f.css("left",w),(0-x>0||0-w>0||u.height-(x+f.height())<0||u.width-(w+f.width())<0)&&(P=!0),0!=t.series.pie.label.background.opacity){var y=t.series.pie.label.background.color;null==y&&(y=i.color);var M="top:"+x+"px;left:"+w+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+f.width()+"px;height:"+f.height()+"px;"+M+"background-color:"+y+';"> </div>').insertBefore(f).css("opacity",t.series.pie.label.background.opacity)}}}(r[a],i,a),i+=r[a].angle}(),ctx.restore()}();n>=M&&(a(),g.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),i.setSeries&&i.insertLegend&&(i.setSeries(r),i.insertLegend())}}function l(e){t.series.pie.innerRadius>0&&(e.save(),innerRadius=t.series.pie.innerRadius>1?t.series.pie.innerRadius:f*t.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function n(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}function o(e){c("plothover",e)}function p(e){c("plotclick",e)}function c(e,i){var a=s.offset(),r=function(e,t){for(var i=s.getData(),a=s.getOptions(),r=a.series.pie.radius>1?a.series.pie.radius:f*a.series.pie.radius,l=0;l<i.length;++l){var o=i[l];if(o.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,r,o.startAngle,o.startAngle+o.angle,!1),ctx.closePath(),x=e-v,y=t-b,ctx.isPointInPath){if(ctx.isPointInPath(e-v,t-b))return ctx.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:l}}else if(p1X=r*Math.cos(o.startAngle),p1Y=r*Math.sin(o.startAngle),p2X=r*Math.cos(o.startAngle+o.angle/4),p2Y=r*Math.sin(o.startAngle+o.angle/4),p3X=r*Math.cos(o.startAngle+o.angle/2),p3Y=r*Math.sin(o.startAngle+o.angle/2),p4X=r*Math.cos(o.startAngle+o.angle/1.5),p4Y=r*Math.sin(o.startAngle+o.angle/1.5),p5X=r*Math.cos(o.startAngle+o.angle),p5Y=r*Math.sin(o.startAngle+o.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],n(arrPoly,arrPoint))return ctx.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:l};ctx.restore()}}return null}(parseInt(i.pageX-a.left),parseInt(i.pageY-a.top));if(t.grid.autoHighlight)for(var l=0;l<I.length;++l){var o=I[l];o.auto!=e||r&&o.series==r.series||function(e){null==e&&(I=[],s.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var t=h(e);-1!=t&&(I.splice(t,1),s.triggerRedrawOverlay())}(o.series)}r&&function(e,t){"number"==typeof e&&(e=series[e]);var i=h(e);-1==i?(I.push({series:e,auto:t}),s.triggerRedrawOverlay()):t||(I[i].auto=!1)}(r.series,e);var p={pageX:i.pageX,pageY:i.pageY};g.trigger(e,[p,r])}function h(e){for(var t=0;t<I.length;++t)if(I[t].series==e)return t;return-1}function d(e,t){var s=e.getOptions(),a=s.series.pie.radius>1?s.series.pie.radius:f*s.series.pie.radius;for(t.save(),t.translate(v,b),t.scale(1,s.series.pie.tilt),i=0;i<I.length;++i)!function(e){e.angle<0||(t.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,a,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill())}(I[i].series);l(t),t.restore()}var u=null,g=null,f=null,v=null,b=null,w=0,P=!0,M=10,k=.95,m=0,A=!1,I=[];s.hooks.processOptions.push(function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(a),e.hooks.drawOverlay.push(d),e.hooks.draw.push(r))}),s.hooks.bindEvents.push(function(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(o),i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(p)})},options:t,name:"pie",version:"1.0"})}(jQuery);

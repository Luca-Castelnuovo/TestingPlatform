"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t,n){for(var i=t.listSelections(),r=[],a=n?"/":"</",s=t.getOption("autoCloseTags"),l="object"==(void 0===s?"undefined":_typeof(s))&&s.dontIndentOnSlash,d=0;d<i.length;d++){if(!i[d].empty())return e.Pass;var f=i[d].head,c=t.getTokenAt(f),u=e.innerMode(t.getMode(),c.state),g=u.state;if(n&&("string"==c.type||"<"!=c.string.charAt(0)||c.start!=f.ch-1))return e.Pass;var m;if("xml"!=u.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==u.mode.name)m=a+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=u.mode.name)return e.Pass;m=a+"style"}else{if(!g.context||!g.context.tagName||o(t,g.context.tagName,f,g))return e.Pass;m=a+g.context.tagName}">"!=t.getLine(f.line).charAt(c.end)&&(m+=">"),r[d]=m}if(t.replaceSelections(r),i=t.listSelections(),!l)for(d=0;d<i.length;d++)(d==i.length-1||i[d].head.line<i[d+1].head.line)&&t.indentLine(i[d].head.line)}function n(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function o(t,n,o,i,r){if(!e.scanForClosingTag)return!1;var a=Math.min(t.lastLine()+1,o.line+500),s=e.scanForClosingTag(t,o,null,a);if(!s||s.tag!=n)return!1;for(var l=i.context,d=r?1:0;l&&l.tagName==n;l=l.prev)++d;o=s.to;for(var f=1;f<d;f++){var c=e.scanForClosingTag(t,o,null,a);if(!c||c.tag!=n)return!1;o=c.to}return!0}e.defineOption("autoCloseTags",!1,function(a,s,l){if(l!=e.Init&&l&&a.removeKeyMap("autoCloseTags"),s){var d={name:"autoCloseTags"};("object"!=(void 0===s?"undefined":_typeof(s))||s.whenClosing)&&(d["'/'"]=function(n){return function(n){return n.getOption("disableInput")?e.Pass:t(n,!0)}(n)}),("object"!=(void 0===s?"undefined":_typeof(s))||s.whenOpening)&&(d["'>'"]=function(t){return function(t){if(t.getOption("disableInput"))return e.Pass;for(var a=t.listSelections(),s=[],l=t.getOption("autoCloseTags"),d=0;d<a.length;d++){if(!a[d].empty())return e.Pass;var f=a[d].head,c=t.getTokenAt(f),u=e.innerMode(t.getMode(),c.state),g=u.state;if("xml"!=u.mode.name||!g.tagName)return e.Pass;var m="html"==u.mode.configuration,p="object"==(void 0===l?"undefined":_typeof(l))&&l.dontCloseTags||m&&i,h="object"==(void 0===l?"undefined":_typeof(l))&&l.indentTags||m&&r,y=g.tagName;c.end>f.ch&&(y=y.slice(0,y.length-c.end+f.ch));var v=y.toLowerCase();if(!y||"string"==c.type&&(c.end!=f.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==g.type||c.string.indexOf("/")==c.string.length-1||p&&n(p,v)>-1||o(t,y,f,g,!0))return e.Pass;var b=h&&n(h,v)>-1;s[d]={indent:b,text:">"+(b?"\n\n":"")+"</"+y+">",newPos:b?e.Pos(f.line+1,0):e.Pos(f.line,f.ch+1)}}var x="object"==(void 0===l?"undefined":_typeof(l))&&l.dontIndentOnAutoClose;for(d=a.length-1;d>=0;d--){var P=s[d];t.replaceRange(P.text,a[d].head,a[d].anchor,"+insert");var T=t.listSelections().slice(0);T[d]={head:P.newPos,anchor:P.newPos},t.setSelections(T),!x&&P.indent&&(t.indentLine(P.newPos.line,null,!0),t.indentLine(P.newPos.line+1,null,!0))}}(t)}),a.addKeyMap(d)}});var i=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],r=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];e.commands.closeTag=function(e){return t(e)}});